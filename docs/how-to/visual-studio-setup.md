# Visual Studio 环境配置指南

本指南为使用 Visual Studio 的开发者提供常见问题的解决方案，包括首次恢复依赖时的凭据配置，以及 Release 编译模式下可能遇到的文件占用错误。

## 凭据配置：访问 GitHub Packages

当你首次在 Visual Studio 中打开解决方案或手动恢复 NuGet 包时，由于项目依赖了托管在 GitHub Packages 上的私有包，VS 会自动弹出凭据输入窗口。

请按以下方式填写：

- **用户名**：你的 GitHub 用户名（或任意非空字符串）。
- **密码**：你的 GitHub Personal Access Token (PAT)。

> [!IMPORTANT]
> 用于密码的 PAT 必须拥有 `read:packages` 权限。你可以从 [GitHub 个人访问令牌设置页面](https://github.com/settings/tokens) 创建。

### 清除已缓存的错误凭据

如果在凭据弹窗中输入了错误的信息，Visual Studio 会将其缓存，导致后续的依赖恢复持续失败。可以通过清空 NuGet 缓存来移除错误凭据。

**通过 Visual Studio 清空缓存**

1. 打开 Visual Studio，依次进入 **工具** > **选项**。
2. 在左侧导航中选择 **NuGet 程序包管理器** > **常规**。
3. 点击 **清除所有 NuGet 缓存** 按钮。

**通过命令行清空缓存**

```bash
dotnet nuget locals all --clear
```

无论使用哪种方式，清除缓存后再次执行依赖恢复，Visual Studio 会重新弹出凭据窗口，届时可以输入正确的信息。

## 解决 Release 编译中的文件占用错误

在 Visual Studio 中，使用 `Release` 配置进行编译时，本仓库的构建系统会启用 `ILRepack` 工具来将所有依赖项合并到单个程序集文件中。根据社区经验，此问题通常与杀毒软件的实时扫描功能有关。在 Release 编译期间，`ILRepack` 会进行大量文件操作，这可能触发实时扫描并导致文件被临时锁定，从而引发“文件正在由另一进程使用...”的错误。

如果你的开发环境也受此影响，可以尝试将项目目录添加到杀毒软件的排除项中。以下以 Windows 平台常见的 Microsoft Defender 为例说明操作步骤：

1. 打开 **Windows 安全中心**。
2. 进入 **病毒和威胁防护** > **“病毒和威胁防护”设置** > **管理设置**。
3. 向下滚动到 **排除项**，点击 **添加或删除排除项**。
4. 点击 **添加排除项**，选择 **文件夹**，然后将本仓库的根目录（`lf2-taiwu-mods`）完整添加进去。
5. **重启计算机** 使设置完全生效。

> [!WARNING]
> 将文件夹添加到排除项会使其免受病毒扫描，这意味着其中潜藏的恶意软件将不会被检测到。请确保你信任该文件夹中的所有文件来源，并自行承担相应风险。

> [!NOTE]
> 此方法在 Visual Studio 2026 环境下经过测试，确能解决 `ILRepack` 引起的文件占用问题。重启计算机是确保排除项完全生效的推荐步骤。
