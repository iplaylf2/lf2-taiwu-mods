# 离线环境下的游戏依赖准备

本文档聚焦于“如何在离线或受限网络环境下，准备游戏核心依赖”这一问题。通过将依赖打包到本地 NuGet 源，你可以在没有私有远程仓库的情况下完成开发环境搭建。

## 适用场景

- 新加入项目、尚未申请到私有源凭据的开发者。
- 仅在本机快速验证或演示 Mod，暂不需要远程依赖分发。
- 构建机无法访问 GitHub Packages 等远程源，但可以读取受控的本地目录。

---

## 将依赖项打包到本地并恢复

> [!NOTE]
> **方案互斥**
> 请注意：本地方案与主文档中推荐的远程源方案是互斥的，请不要同时启用。如需切换回远程源方案，请参考主方案文档中的指引。

此方法是解决游戏核心程序集依赖问题的最直接方案，适合快速上手、项目初期验证或快速调试。它将这些依赖打包到项目本地的 `.lf2.nupkg` 目录下，供 `dotnet restore` 直接使用，从而避免了它们的网络分发。

1. **准备文件**：将需要打包的程序集（DLL 文件）放入对应 `unmanaged-vendor` 项目下的 `lib/` 目录中。关于游戏核心程序集的目录结构，请参阅 `projects/unmanaged-vendor/README.md` 中的“必要目录结构”一节。
2. **打包**：在**仓库根目录**下运行 `dotnet pack --no-restore -c Release`。此命令会将 `unmanaged-vendor` 目录下的所有项目打包至 `.lf2.nupkg/` 文件夹，并避免在离线环境中触发额外的还原请求。
3. **启用本地源**：在**仓库根目录**下运行 `dotnet nuget enable source local`。仓库自带的 `nuget.config` 已预置名为 `local` 的源，默认禁用，启用后即可供恢复使用。
4. **恢复**：在**仓库根目录**下运行 `dotnet restore`。NuGet 会自动找到本地包并完成依赖恢复。

> [!TIP]
> `dotnet pack` 命令会一次性处理所有 `unmanaged-vendor` 项目。`lib` 目录为空的项目也会被正常打包成一个空包，以确保 `dotnet restore` 能够顺利执行。

完成上述步骤后，依赖恢复流程与远程私有源完全一致：执行 `dotnet restore` 即可编译 Mod。若需要切换回远程源，只需运行 `dotnet nuget disable source local` 禁用本地源，并重新启用私有源，无须额外清理本地包。
