<Project>
  <Target Name="PackGameLibraries">
    <Message Text="[LF2GameLib] Packing game libraries..." Importance="high" />

    <ItemGroup>
      <_GameLibrarySourceDir Include="$(MSBuildThisFileDirectory)Taiwu.*" />
    </ItemGroup>

    <ItemGroup>
      <PackageToCreate Include="@(_GameLibrarySourceDir)">
        <PackageId>%(Filename)</PackageId>
        <LF2PackageType Condition=" Exists('%(Identity)/lib/backend') and  Exists('%(Identity)/lib/frontend')">common</LF2PackageType>
        <LF2PackageType Condition=" Exists('%(Identity)/lib/backend') and !Exists('%(Identity)/lib/frontend')">backend-only</LF2PackageType>
        <LF2PackageType Condition="!Exists('%(Identity)/lib/backend') and  Exists('%(Identity)/lib/frontend')">frontend-only</LF2PackageType>
      </PackageToCreate>
    </ItemGroup>

    <ItemGroup>
      <_InvalidPackage Include="@(PackageToCreate)" Condition="'%(LF2PackageType)' == ''" />
      <PackageToCreate Remove="@(_InvalidPackage)" />
    </ItemGroup>

    <Message Text="[LF2GameLib] WARNING: Found invalid package definitions, they will be skipped: @(_InvalidPackage->'%(Identity)', ', ')" Importance="high" Condition="'@(_InvalidPackage)' != ''" />

    <MSBuild
      Projects="$(MSBuildThisFileDirectory)Template.csproj"
      Targets="Pack"
      Properties="
        PackageId=%(PackageToCreate.PackageId);
        LF2PackageDir=%(PackageToCreate.Identity);
        LF2PackageType=%(PackageToCreate.LF2PackageType);
        Version=$(Version)
      "
    />
  </Target>
</Project>